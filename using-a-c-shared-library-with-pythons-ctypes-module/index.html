<!doctype html>
<html lang="en">
  <head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-71148736-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-71148736-1');
</script>
    <title>Using a C shared library with Python's ctypes module - Elyézer Rezende</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <meta name="author" content="Elyézer Rezende" />
  <meta name="keywords" content="python" />
  <meta name="description" content="To demonstrate how to create a shared C library and using it with Python&#39;s ctypes library we are going to create a shared C library. First create the C header file mean.h: // Returns the mean of passed parameters double mean(double, double); Next create the C file mean.c …" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://elyezer.com/static/css/tipuesearch.css" />
    <link rel="stylesheet" href="https://elyezer.com/static/css/main.css" />

    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>

    <link href="https://elyezer.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Elyézer Rezende Full Atom Feed" />
    <link href="https://elyezer.com/feeds/python.atom.xml" type="application/atom+xml" rel="alternate" title="Elyézer Rezende Categories Atom Feed" />
  </head>

  <body>
    <nav class="navbar navbar-expand-md fixed-top navbar-light">
      <a class="navbar-brand" href="https://elyezer.com/">Elyézer Rezende</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" href="https://elyezer.com/pages/about/">About</a>
            </li>
        </ul>
        <form class="form-inline my-2 my-lg-0" action="/search/">
          <input class="form-control mr-sm-2" id="tipue_search_input" name="q" type="search" placeholder="Search" aria-label="Search">
          <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>
      </div>
    </nav>

    <div class="container">
      <div class="row">
        <div class="col-md-9">
<section id="content">
  <article clas="hentry">
    <header class="entry-header">
      <div class="entry-meta">
        <i class="far fa-calendar-alt"></i>
        <time class="entry-date" datetime="2018-03-09T00:00:00-03:00">Fri 09 March 2018</time>

<i class="far fa-comments"></i> <a href="https://elyezer.com/using-a-c-shared-library-with-pythons-ctypes-module/#disqus_thread">comments</a>
        <i class="far fa-user"></i>
        <a href="https://elyezer.com/author/elyezer-rezende/">Elyézer Rezende</a>
      </div><!-- /.entry-meta -->
      <h1>
        <a href="https://elyezer.com/using-a-c-shared-library-with-pythons-ctypes-module/"
          rel="bookmark"
          title="Permalink to Using a C shared library with Python's ctypes module">
          Using a C shared library with Python's ctypes module
        </a>
      </h1>
    </header>
    <div class="entry-content">
      <p>To demonstrate how to create a shared C library and using it with Python's
<a class="reference external" href="https://docs.python.org/3/library/ctypes.html">ctypes</a> library we are going to create a shared C library. First create the C
header file <cite>mean.h</cite>:</p>
<div class="highlight"><pre><span></span><span class="c1">// Returns the mean of passed parameters</span>
<span class="kt">double</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="p">);</span><span class="w"></span>
</pre></div>
<p>Next create the C file <cite>mean.c</cite>:</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;mean.h&quot;</span><span class="cp"></span>

<span class="kt">double</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
<p>Now we can create the shared C library by compiling it using <cite>gcc</cite>:</p>
<div class="highlight"><pre><span></span><span class="gp">$ </span>gcc -shared -o libmean.so.1 mean.c
</pre></div>
<p>Finally we can import the shared C library using the ctypes Python module,
consider the following interative shell:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">ctypes</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">libmean</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="s1">&#39;./libmean.so.1&#39;</span><span class="p">)</span> <span class="c1"># loads the shared library</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">libmean</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span> <span class="c1"># define mean function return type</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">libmean</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="c1"># call mean function needs cast arg types</span>
<span class="mf">6.5</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">libmean</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">]</span> <span class="c1"># define arguments types</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">libmean</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="c1"># call mean function does not need cast arg types</span>
<span class="mf">6.5</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="n">libmean</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="c1"># returned value is converted to python types</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">float</span><span class="s1">&#39;&gt;</span>
</pre></div>
<p>This was tested using Python 3.6.4 and gcc 7.3.1 on Fedora 27. Check the
<a class="reference external" href="https://docs.python.org/3/library/ctypes.html">ctypes</a> documentation for more information.</p>

    </div> <!-- /.entry-content -->
    <footer class="entry-footer">
      <p>
        <i class="fa fa-folder-open"></i>
        <a href="https://elyezer.com/category/python/">Python</a>
      </p>

      <p>
        <i class="fa fa-tags"></i>
        <a href="https://elyezer.com/tag/python/">python</a>      </p>
    </footer><!-- /.entry-footer -->
  </article>
</section>

<section class="comments" id="comments">
  <h2>Comments</h2>

  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://elyezer.com/using-a-c-shared-library-with-pythons-ctypes-module/';
      this.page.identifier = 'using-a-c-shared-library-with-pythons-ctypes-module/';
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://elyezer.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the comments.</noscript>
</section>
        </div>
        <aside id="sidebar" class="col-md-3">
          <section id="aboutme">
            <p>
              <img class="d-block img-thumbnail mx-auto rounded-circle" src="https://elyezer.com/images/elyezer-rezende.jpg"/>
            </p>
            <p><strong>Elyézer Rezende</strong> is a Red Hatter, Quality Engineer, Pythonista, Open Source advocate, Podcaster and Dad.</p>
          </section><!-- #aboutme -->

          <section id="social">
            <h4>Social</h4>
            <div class="list-group list-group-flush">
              <a class="list-group-item list-group-item-action" href="https://www.facebook.com/elyezer" target="_blank"><i class="fab fa-facebook"></i> Facebook</a>
              <a class="list-group-item list-group-item-action" href="https://github.com/elyezer" target="_blank"><i class="fab fa-github"></i> Github</a>
              <a class="list-group-item list-group-item-action" href="https://www.linkedin.com/in/elyezer" target="_blank"><i class="fab fa-linkedin"></i> LinkedIn</a>
              <a class="list-group-item list-group-item-action" href="https://twitter.com/elyezer" target="_blank"><i class="fab fa-twitter"></i> Twitter</a>
            </div><!-- .list-group -->
          </section><!-- #social -->

          <section id="categories">
            <h4>Categories</h4>
            <div class="list-group list-group-flush">
              <a href="https://elyezer.com/category/python/" class="list-group-item list-group-item-action active">
                <i class="fa fa-folder-open"></i>
                Python
              </a>
              <a href="https://elyezer.com/category/quality-engineering/" class="list-group-item list-group-item-action">
                <i class="fa fa-folder-open"></i>
                Quality Engineering
              </a>
            </div><!-- .list-group -->
          </section><!-- #categories -->

          <section id="links">
            <h4>Links</h4>
            <div class="list-group list-group-flush">
              <a href="http://castalio.info/" class="list-group-item list-group-item-action" target="_blank">
                <i class="fas fa-external-link-alt"></i>
                Castálio Podcast
              </a>
            </div><!-- .list-group -->
          </section><!-- #links -->

          <section id="archive">
            <h4>Archive</h4>
            <div class="list-group list-group-flush">
              <a href="" class="list-group-item list-group-item-action">
                <i class="far fa-calendar-alt"></i>
                June 2018 (1)
              </a>
              <a href="" class="list-group-item list-group-item-action">
                <i class="far fa-calendar-alt"></i>
                March 2018 (1)
              </a>
            </div><!-- .list-group -->
          </section><!-- #archive -->
        </aside>
      </div><!-- .row -->
    </div><!-- .container -->

    <footer id="footer" class="bg-light">
      <p>
        Powered by
        <a href="http://getbootstrap.com" target="_blank">Bootstrap</a> and
        <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>.
      </p>
      <p><small>  <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="//i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a>
    Content
  licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>, except where indicated otherwise.
</small></p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <script id="dsq-count-scr" src="//elyezer.disqus.com/count.js" async></script>
  </body>
</html>